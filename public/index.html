<!DOCTYPE html>
<html>
<head>
    <title>Ping Pong Game</title>
</head>
<body>
    <canvas id="canvas" width="800" height="400"></canvas>
    <script type="text/javascript" src="js/app.js"></script>
    <style>
#canvas {
    position: fixed; /* absolute */
    top: 0;
    left: 0;
    width: 100vw;    /* 100% */
    height: 100vh;   /* 100% */
    background-color: black;
} 
    </style>
    <script type="text/javascript">

        app.onInit = function(){

            this.nodes.push({
                id : 'player1',
                x  : 0,
                y  : app.height/2-app.width/20,
                width  : app.width/40,
                height : app.height/3,
                color  : 'white',
                direction : 0,
                velocity: 0.01
            });

            this.nodes.push({
                id : 'player2',
                x  : app.width-app.width/40,
                y  : app.height/2-app.width/20,
                width  : app.width/40,
                height : app.height/3,
                color  : 'green',
                direction : 0,
                velocity: 0.01
            });

            this.nodes.push ({
                id:'ball',
                x: app.width/2,
                y: app.height/2,
                width  : app.width/100,
                height : app.height/50,
                color: '#05EDFF',
                radius: 10,
                velocityX:5,
                velocityY:5,
                speed:5
            });

            var gameStart = true

        };

        
        app.onUpdate = function(time){

            //Paddle Movement 
            document.addEventListener('keydown', (event)=>{
                if(event.keyCode == '87')
                {
                    this.getNode('player1').y -= this.getNode('player1').velocity; 

             } else if (event.keyCode == '83'){
                this.getNode('player1').y += this.getNode('player1').velocity; 
                
				} else if (event.keyCode == '38') {
                    this.getNode('player2').y -= this.getNode('player2').velocity; 
                
                } else if (event.keyCode == '40') {
                this.getNode('player2').y += this.getNode('player2').velocity; 
                
                }}) 

            //Game Pause
            

            //Ball Movement
            this.getNode('ball').x += this.getNode('ball').velocityX;
            this.getNode('ball').y += this.getNode('ball').velocityY;

            //Checks to see if the ball has collided with the walls
            if(this.getNode("ball").y + this.getNode("ball").width > app.height || this.getNode("ball").y - this.getNode("ball").width < 0) {
                this.getNode("ball").velocityY = -this.getNode("ball").velocityY;
            } 

            //Checks to see if the ball has collided with the paddles
            function collision(b,p){
                p.top = p.y;
                p.bottom = p.y + p.height;
                p.left = p.x;
                p.right = p.x + p.width;
                
                b.top = b.y - b.height;
                b.bottom = b.y + b.height;
                b.left = b.x - b.width;
                b.right = b.x + b.width;
    
                return p.left < b.right && p.top < b.bottom && p.right > b.left && p.bottom > b.top;
            }

            let currentPlayer = (this.getNode("ball").x < app.width/2) ? this.getNode('player1') : this.getNode('player2');

            if (collision(this.getNode("ball"),currentPlayer))   {

                let collidePoint = (this.getNode("ball").y - (currentPlayer.y + currentPlayer.height/2));

                collidePoint = collidePoint / (currentPlayer.height/2);

                let angleRad = (Math.PI/4) * collidePoint;
                
                let direction = (this.getNode("ball").x + this.getNode("ball").radius < app.width/2) ? 1 : -1;
                this.getNode("ball").velocityX = direction * this.getNode("ball").speed * Math.cos(angleRad);
                this.getNode("ball").velocityY = this.getNode("ball").speed * Math.sin(angleRad);
                
                this.getNode("ball").speed += 0.1;
    }

        //Reset Ball Upon Score
        if( this.getNode("ball").x < 0 ){
            console.log("Point for Player 2!")
            this.getNode('ball').x = app.width/2;
            this.getNode('ball').y = app.height/2;
            this.getNode('ball').velocityX = -this.getNode('ball').velocityX;
            this.getNode('ball').speed = 5;
        }else if( this.getNode('ball').x > app.width){
            console.log("Point for Player 1!")
            this.getNode('ball').x = app.width/2;
            this.getNode('ball').y = app.height/2;
            this.getNode('ball').velocityX = -this.getNode('ball').velocityX;
            this.getNode('ball').speed = 5;
        }

    };
    </script>
</body>
</html>